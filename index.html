<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Global Chat</title>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
    margin: 0;
    font-family: system-ui, Arial;
    background: #0f172a;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.chat-box {
    width: 400px;
    background: #020617;
    border-radius: 14px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 40px rgba(0,0,0,.6);
}

header {
    padding: 14px;
    font-weight: bold;
    background: #020617;
    border-bottom: 1px solid #1e293b;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
}

.msg {
    margin-bottom: 6px;
    font-size: 14px;
}

.name {
    font-weight: bold;
}

.time {
    font-size: 10px;
    color: #94a3b8;
    margin-left: 5px;
}

footer {
    padding: 10px;
    border-top: 1px solid #1e293b;
    display: flex;
}

#input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: #020617;
    color: white;
    outline: none;
}

#changeName {
    margin-left: 5px;
    background: #64748b;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0 10px;
    cursor: pointer;
}
</style>
</head>
<body>

<div class="chat-box">
    <header>
        ðŸ’¬ Global Chat
        <button id="changeName">Name Ã¤ndern</button>
    </header>

    <div id="messages"></div>

    <footer>
        <input id="input" placeholder="Nachricht eingeben (Enter drÃ¼cken)">
    </footer>
</div>

<script>
/* ðŸ”‘ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyASgfGX-RD3i39XeodTBDh3p4cT6rkzPBo",
  authDomain: "chat-5ac8d.firebaseapp.com",
  databaseURL: "https://chat-5ac8d-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "chat-5ac8d",
  storageBucket: "chat-5ac8d.firebasestorage.app",
  messagingSenderId: "811185278248",
  appId: "1:811185278248:web:b3e67b65ff49455dacd41d"
};

/* INIT FIREBASE */
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* LOCALSTORAGE NAME */
let username = localStorage.getItem("username");
if(!username){
    username = prompt("Dein Name:");
    localStorage.setItem("username", username);
}

/* ELEMENTE */
const input = document.getElementById("input");
const messages = document.getElementById("messages");
const changeBtn = document.getElementById("changeName");

/* ENTER ZUM SENDEN */
input.addEventListener("keydown", e => {
    if(e.key === "Enter" && input.value.trim() !== ""){
        sendMessage();
    }
});

/* NAME Ã„NDERN */
changeBtn.addEventListener("click", ()=>{
    let newName = prompt("Neuer Name:", username);
    if(newName && newName.trim() !== ""){
        username = newName.trim();
        localStorage.setItem("username", username);
    }
});

/* SENDEN */
function sendMessage(){
    const color = "#" + Math.floor(Math.random()*16777215).toString(16); // zufÃ¤llige Farbe
    db.ref("messages").push({
        name: username,
        text: input.value,
        time: Date.now(),
        color: color
    });
    input.value = "";
}

/* ZEITFORMAT */
function formatTime(ms){
    const date = new Date(ms);
    return date.getHours().toString().padStart(2,"0") + ":" + date.getMinutes().toString().padStart(2,"0");
}

/* NACHRICHTEN LADEN */
db.ref("messages").limitToLast(100).on("child_added", snapshot=>{
    const data = snapshot.val();
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<span class="name" style="color:${data.color}">${data.name}:</span> ${data.text} <span class="time">${formatTime(data.time)}</span>`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
});
</script>

</body>
</html>
